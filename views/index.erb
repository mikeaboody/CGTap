<!DOCTYPE html>
<html lang="en">
<head>
  <title>CGTap</title>
  <link rel="stylesheet" href= "bootstrap-select/css/bootstrap-select.min.css">
  <link rel="stylesheet" href="bootstrap-3.3.4-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <link href='style/main.css' rel='stylesheet'>
  <link rel="stylesheet" type="text/css" href="sweetalert-master/dist/sweetalert.css">
  <link rel="stylesheet" href="/navgoco/src/jquery.navgoco.css" type="text/css" media="screen" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script src="bootstrap-3.3.4-dist/js/bootstrap.min.js"></script>
  <script src="sweetalert-master/dist/sweetalert.min.js"></script>
  <script src="bootstrap-select/js/bootstrap-select.min.js"></script>
  <script type="text/javascript" src="navgoco/src/jquery.cookie.js"></script>
    <!-- Load jquery.navgoco plugin js and css files -->
  <script type="text/javascript" src="navgoco/src/jquery.navgoco.js"></script>
  <script src='d3/d3.js'></script>
  <script src='d3/d3.min.js'></script>
  
  <script>
    var master_email = "<%= @email %>";
    var event_json = <%= @json %>;
  </script>
  <script src="./script/Objects.js"></script>
  <script src="./script/Setup.js"></script>
  <script src="./script/UserInterface.js"></script>
  <script src="./script/Submit.js"></script>
  <script src="./script/Main.js"></script>
  <script src="./script/DisplayTimesheetData.js"></script>
  <script src="./script/EnteredTime.js"></script>
  <script type="text/javascript">
$(document).ready(function(){                       

       //Navigation Menu Slider
        $('#nav-expander').on('click',function(e){
          e.preventDefault();
          $('body').toggleClass('nav-expanded');
          $('body').find('#time_sheet_table').addClass('shrink');
          $('body').find('.navbar').addClass('navshrink');
        });
        $('#nav-close').on('click',function(e){
          e.preventDefault();
          $('body').removeClass('nav-expanded');
          $('body').find('#time_sheet_table').removeClass('shrink');
          $('body').find('.navbar').removeClass('navshrink');
        });

        // Initialize navgoco with default options
        $(".main-menu").navgoco({
            caret: '<span class="caret"></span>',
            accordion: false,
            openClass: 'open',
            save: true,
            cookie: {
                name: 'navgoco',
                expires: false,
                path: '/'
            },
            slide: {
                duration: 300,
                easing: 'swing'
            }
        });

      });


</script>
</head>
  <body>
    <div class='container'>
      <div class='navbar navbar-default navbar-fixed-top'>
         <div class='container'>
          <a href='/' class='navbar-brand pull-left'>Tap App</a>
            <h2 class="welcome">Loading...<span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></h2>
          </div>
          <div id="donut" data-donut="24">
                      <script>
            var donutChart;
(function() {
  var w = 250,
   h = 150,
   r = 50,
   innerRadius = 40,
   transitionsDuration = 1000,
   transitionsDelay = 250,
   hoursTextSize = '1.5rem';

  // This is the scale to avoid using gradiant for the angles.
  var rScale = d3.scale.linear().domain([0, 24]).range([0, 2 * Math.PI]);

  // Here we use the helper function of d3 to draw arcs easier
  var arc = d3.svg.arc()
    .outerRadius(r + 0.8)
    .innerRadius(innerRadius);

  // Another helper function of d3 to bind the data to the arcs
  var pie = d3.layout.pie()
    .value(function(d) {
      return d.value;
    });

  donutChart = {
    /**
     * A d3 function that draws a donut chart.
     */
    draw: function(container, data) {

      var svg = d3.select('#donut').append('svg');

      createBigCircle(svg);
      var vis = createChartContainer(svg, data);
      drawChartArcs(vis, data);
      createSmallCircle(vis);
      drawHoursText(vis, data);
      // drawInformativeText(vis, data);

    }
  };

  // Here we create the big circle (the outer one)
  function createBigCircle(svg) {
    svg.append('circle')
      .attr('cx', r)
      .attr('cy', r)
      .attr('r', r)
      .attr('class', 'pie-graph-big-circle');
  }

  // Here we give dimensions to the svg and create a g container
  function createChartContainer(svg, data) {
    return svg
      .data([data])
      .attr('width', w)
      .attr('height', h)
      .append('g')
      .attr('transform', 'translate(' + r + ',' + r + ')');
  }

  // We draw the arc in here, give it an smooth transition and the correct color depending on the data.
  function drawChartArcs(visualization, data) {
    var arcs = visualization.selectAll('g')
      .data(pie)
      .enter()
      .append('g');

    arcs.append('path')
    /*.attr('transform', function(d){return 'rotate('+rotationAngle(d.value)+')' })*/
    .attr('fill', function(d, i) {
      return data[i].color;
    })
      .each(function(d) {
        d.endAngle = 0;
      })
      .attr('d', arc)
      .transition()
      .duration(transitionsDuration)
      .delay(transitionsDelay)
      .ease('elastic')
      .call(arcTween, this);
  }

  // This help us achieve the arcs transitions.
  function arcTween(transition, newAngle) {

    transition.attrTween("d", function(d) {

      var interpolate = d3.interpolate(0, 360 * (d.value / 24) * Math.PI / 180);

      return function(t) {

        d.endAngle = interpolate(t);

        return arc(d);
      };
    });
  }

  // This is the small circle, the one with the text in the middle.
  function createSmallCircle(visualization) {
    visualization.append('circle')
      .attr('cx', 0)
      .attr('cy', 0)
      .attr('r', innerRadius)
      .attr('class', 'pie-graph-small-circle');
  }

  // This is the percentage text, it appears with the same transition as the path/arcs
  function drawHoursText(visualization, data) {
    visualization.append('text')
      .data(data)
      .attr("font-family", "Arial")
      .attr("font-size", "0px")
      .attr("fill", "white")
      .attr('text-anchor', 'middle')
      .attr('y', '5px')
      .text(function(d) {
        return d.value + " hours";
      })
      .transition()
      .attr('font-size', hoursTextSize)
      .duration(transitionsDuration)
      .delay(transitionsDelay)
      .ease('elastic');
  }
})();

donutChart.draw('#donut-chart', [{value: 6.5, color: '#75ad3e', middleText: 'TARGET'}] )
      </script>
                 
           
          </div>


            <ul class="nav navbar-nav nav-pills pull-right">
               <li><button type="button"  class="btn" data-toggle="modal" data-target="#myModal" style="background-color: #676767" role="button">Past Timesheets</button></li>
              <li class="active"><button type="button" id="nav-expander" class="btn" style="background-color: #676767" role="button">Calendar</button></li>    
              <li><div class="submit">
              <button onclick="submit()" class="btn" style="background-color: #ff6600">Submit</button>
              </div></li>
              <li class="logout">
              <button type="button" onclick="location.href = '/logout'" class="btn" style="background-color: #676767"  role="button">Log Out</a></button></li>
            </ul></div>
      </div>
<nav>
   <div class="panel-body">
      <ul class="list-unstyled main-menu">
        <li class="text-right"><a href="#" id="nav-close">X</a></li>
          <div class = "container calendar_date">
           <p><input type="text" class="datepicker" readonly="readonly"></p>
          </div>
           <p>Google Calendar</p> 
              <table id = "event_table" class="table table-hover"></table>
    </div> 
</nav>
 
    </div>
</div>
    
    </div>
                       
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <div class="content" hidden >

     
        <div class = "row">
          <div class = "submit_date">
            <p><input type="text" class="datepicker" readonly="readonly"></p>
          </div>
        </div>
        <div class="row">
            <table id="time_sheet_table"class="table table-responsive table-hover table-striped">
              <thead>
                <tr>
                  <th></th>
                  <th>Project</th>
                  <th>Task</th>
                  <th>Billing</th>
                  <th>Description</th>
                  <th>Timer</th>
                  <th>Manual</th>
                </tr>
              </thead>
                <tbody>
                  <tr>
                    <td style = "width: 5%">
                      <div class="frame">
                        <span class="helper"></span><img src="images/icon.png" height="42" width="42"/>
                      </div>
                    </td>
                    <td class = "col-md-2">
                      <div class = "projects">
                        <select class = "selectpicker" data-size="false" data-width="200px" data-style="btn-info">
                          <option value =""selected>Project</option>
                        </select>
                      </div>
                    </td>
                    <td class = "col-md-2">
                      <div class = "tasks">
                        <select class = "selectpicker" data-size="false" data-width="200px" data-style="btn-info">
                         <option value =""selected>Task</option>
                        </select>
                      </div>
                    </td>
                    <td class = "col-md-1">
                      <div class="payment">
                        <select class = "selectpicker" data-size="false" data-width="125px" data-style="btn-info">
                          <option value =""selected>Billing</option>
                        </select>
                      </div>
                    </td>
                    <td class = "col-md-2">
                      <div class = "notes">
                        <textarea class = "form-control" style = "resize: none;"rows="4" cols="30" placeholder="Enter a description..."></textarea>
                      </div>
                    </td>
                    <td class = "col-md-1">
                      <div class="timer">
                        <button class="timer_button">Start</button><br>
                        <label>00:00:00</label>
                      </div>
                    </td>
                    <td class = "col-md-2">
                        <form name="input">
                          <input class="hours form-control" type="text" name="hours" placeholder="0" style = "width: 50px; display: inline; text-align: center;"> :
                          <input class="minutes form-control" type="text" name="minutes" placeholder="00" style = "width: 50px; display: inline; text-align: center;"> <br>
                          <label style = "padding-left:3%;">hours</label>
                          <label style = "padding-left:5%;">minutes</label>
                        </form>
                    <td class = "col-md-1">
                      <div class="deleteRow">
                        <button class="btn btn-danger btn-xs" data-toggle="tooltip" data-placement="right" title="Delete a project" aria-label="Delete"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
              <hr/ width = 100%>
              <div class="addRow" style = "margin-top:-18px;">
                <button onclick="addRow()" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="Add a project" aria-label="Add"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
               </button>
              </div>    
            </div>
          </div>
          <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title" id="myModalLabel">Past Timesheets</h4>
                </div>
            <div class="modal-body">
              <p> Put a lot of information here. Let it really spread out so that people can know everything that has happened in the last seven days </p>
              <script>
              displayData()
              timesheets = [];
              var createData = function() {
                var data = [];
                for (var i = 0; i < timesheets.length; i += 1) {
                var dataPoint = {"label":timesheets[i].project_name, "value":timesheets[i].hours};
                  data.push(dataPoint);
                }
                return data;
              }
              var width = 250,
              height = 250,
               radius = 125,
                colors = d3.scale.ordinal()
                .range(['#71D18A', '#29a949', '#037220']);

              var piedata = [
                { label: "", 
                 value: 50}, 
                { label:"", 
                 value: 50},
                { label:"", 
                  value: 50}
      
                ]

              var pie = d3.layout.pie()
               .value(function(d) {
                 return d.value;
                })
              var arc = d3.svg.arc()
              .innerRadius(radius - 100)
              .outerRadius(radius - 50);

              var myChart = d3.select('.modal-body').append('svg')
                .attr('width', width)
                .attr('height', height)
                .append('g')
                .attr('transform', 'translate('+(width - radius)+', '+(height-radius)+')')
                .selectAll('path').data(pie(piedata))
                .enter().append('g')
  // create a class called slice to slap some data on
                .attr('class', 'slice')

              var slices = d3.selectAll('g.slice')
                .append('path')
                .attr('fill', function(d, i) {
                 return colors(i); 
               })
                .attr('d', arc)
// each element has its own data object   
              var text = d3.selectAll('g.slice')
                .append('text')
                .text(function(d, i) {
                   return d.data.label;
                })
// here come the attributes which format
               .attr('text-anchor', 'middle')
              .attr('fill', 'black')
             .attr('transform', function(d){ 
              d.innerRadius = 0;
              d.outerRadius = radius;
                return 'translate('+ arc.centroid(d)+')'
                      })

             </script>

              <%= erb :display %>

              

        
          </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
       
    </div>
  </body>
</html>